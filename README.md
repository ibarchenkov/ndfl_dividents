# Инструмент для помощи в заполнении декларации 3-НДФЛ на сайте https://lkfl2.nalog.ru/lkfl/ по доходу с дивидендов иностранных компаний с подписанной формой W-8BEN

## Это ПО написано для личного пользования и автор не несёт ответственности за ошибки в поданных с помощью него декларациях! Обязательно вручную проверяйте введённые в автоматическом режиме данные!!!

## На данный момент поддерживается отчётность только от брокера Tinkoff, но в будущем функционал может быть расширен.

## Инструкция к приминению:

Запросите в чате поддержки Тиньков отчётность по дивидендам иностранных компаний за нужный год в формате *.xlsx*

Полученный файл `dividends.XLSX` откройте в Microsoft Excel или загрузите в Google docs.

Далее инструкция для [Google Sheets](https://docs.google.com/spreadsheets/u/0/), в Microsoft Excel всё можно сделать по подобию:

Создайте новую пустую таблицу
В левом верхнум углу нажмите "Файл" => "Импортировать" => "Загрузить" => "Выбрать файл с вашего устройства" => выберите файл с отчётностью `dividends.XLSX` => кликните "Заменить таблицу"

Выделите и удалите все верхние ряды до ряда с описанием данных в колонках (headers)
<img width="1108" alt="Screenshot 2022-04-24 at 23 12 29" src="https://user-images.githubusercontent.com/9252654/164994928-e813b2c4-984e-4b9f-b896-f83c1790cb7a.png">

Найдите все остальные строки не относящиеся к дивидендам и также удалите их
<img width="1051" alt="Screenshot 2021-04-08 at 22 13 22" src="https://user-images.githubusercontent.com/9252654/114083559-cff04800-98b7-11eb-84f0-87b026de865d.png">
<img width="1169" alt="Screenshot 2021-04-08 at 22 15 36" src="https://user-images.githubusercontent.com/9252654/114083716-0332d700-98b8-11eb-9a4a-4f7ac47c1806.png">
Удалите картинку "Тиньков" в верхнем левом углу

*Убедитесь, что вы случайно не удалили из отчёта строки, относящиеся к выплатам по дивидендам!*

Загрузите файл обратно на компьютер в формате CSV. "Файл" => "Загрузить" => "В формате с запятой как разделитель"


Установите язык программирования Elixir https://elixir-lang.org/install.html

Установите Chrome Driver https://sites.google.com/a/chromium.org/chromedriver/downloads

Скачайте этот репозиторий себе на компьютер.

В одном окне терминала (или сессии screen или tmux) запустите `chromedriver`, он должен работать в фоновом режиме.

В другом терминале перейдите в директорию проекта `cd /Users/my-user/Workspace/elixir/ndfl_dividents` (команда для примера, впишите свой путь до репозитория на локальной машине).

Выполните команду `mix deps.get`, затем `iex -S mix`. Запустится консоль Elixir

В консоли Elixir выполните команду `NdflDividents.login`. Запустится браузер Chrome и откроется страница входа в личный кабинет nalog.ru

Введите логин и пароль от личного кабинета. *Это ПО не получает и тем более никуда не отправляет ваш логин/пароль и прочие персональные данные. Вы взамодействуете напрямую с сайтом налоговой.*

В Личном Кабинете перейдите в "Жизненные ситуации" => "Подать декларацию 3‑НДФЛ" => "Заполнить онлайн" => Укажите год и прочие галочки => "Далее" => Выберите вкладку "За пределами РФ"

У вас на экране должна быть такая картинка
<img width="1162" alt="Screenshot 2021-04-09 at 21 00 33" src="https://user-images.githubusercontent.com/9252654/114222012-b5c96f00-9976-11eb-8f89-ef43a7070eaa.png">

После этого скопируйте путь к CSV файлу с дивидендами.

Вернитесь к консоли Elixir и выполните там команду `NdflDividents.run("/Users/ibarch/Workspace/elixir/ndfl_dividents/dividends.csv")` (Вставьте в ковычки путь до вашего файла)

Консоль Elixir должна зависнуть и скрипт начнёт заполнять за вас Источники Дохода. Дождитесь когда он закончит и свернёт все записи. Вот как должен выглядеть процесс работы:

https://user-images.githubusercontent.com/9252654/114225709-5588fc00-997b-11eb-8d4c-b8c74c6d27d3.mov

*Перед отправкой декларации проверьте все записи*

